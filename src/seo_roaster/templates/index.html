<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Roaster - SEO åæ§½å™¨</title>
    <meta name="description" content="è¼¸å…¥ç¶²å€ï¼Œç²å¾—æ¿€çƒˆæ¯’èˆŒçš„ SEO åˆ†æå ±å‘Šã€‚è®“ä½ çš„ç¶²ç«™åœ¨è¢«åæ§½ä¸­é€²æ­¥ã€‚">
    <link rel="canonical" href="https://seo-roaster.zeabur.app/">

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¬</text></svg>">

    <!-- Open Graph -->
    <meta property="og:title" content="SEO Roaster - SEO åæ§½å™¨">
    <meta property="og:description" content="è¼¸å…¥ç¶²å€ï¼Œç²å¾—æ¿€çƒˆæ¯’èˆŒçš„ SEO åˆ†æå ±å‘Š">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://seo-roaster.zeabur.app/">
    <meta property="og:image" content="https://seo-roaster.zeabur.app/static/og-image.webp">
    <meta property="og:locale" content="zh_TW">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="SEO Roaster - SEO åæ§½å™¨">
    <meta name="twitter:description" content="è¼¸å…¥ç¶²å€ï¼Œç²å¾—æ¿€çƒˆæ¯’èˆŒçš„ SEO åˆ†æå ±å‘Š">
    <meta name="twitter:image" content="https://seo-roaster.zeabur.app/static/og-image.webp">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "SEO Roaster",
        "alternateName": "SEO åæ§½å™¨",
        "description": "è¼¸å…¥ç¶²å€ï¼Œç²å¾—æ¿€çƒˆæ¯’èˆŒçš„ SEO åˆ†æå ±å‘Šã€‚è®“ä½ çš„ç¶²ç«™åœ¨è¢«åæ§½ä¸­é€²æ­¥ã€‚",
        "url": "https://seo-roaster.zeabur.app/",
        "applicationCategory": "DeveloperApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>

    <link rel="stylesheet" href="{{ url_for('static', filename='v1-candy-clay.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <img id="mascot" class="mascot" src="{{ url_for('static', filename='mascot/default.webp') }}" alt="å°æ§½" width="120" height="120">
                <div class="header-text">
                    <h1 class="title">
                        <span class="cute">SEO</span> åæ§½å™¨
                    </h1>
                    <p class="subtitle">æŠŠç¶²å€äº¤å‡ºä¾†ï¼Œè®“æˆ‘çœ‹çœ‹ä½ åˆæç ¸äº†ä»€éº¼</p>
                </div>
            </div>
        </header>

        <!-- Input Section -->
        <section class="input-section">
            <form id="analyze-form" class="form">
                <div class="input-wrapper">
                    <input
                        type="text"
                        id="url-input"
                        name="url"
                        placeholder="ç¶²å€ä¸Ÿé€™è£¡"
                        autocomplete="off"
                        spellcheck="false"
                        maxlength="2048"
                    >
                    <button type="submit" id="submit-btn" class="btn-submit">
                        <span class="btn-text">é–‹å§‹åæ§½</span>
                        <span class="btn-loading">æ­£åœ¨æ‰¾ä½ çš„å•é¡Œ...ä¸€å®šå¾ˆå¤š</span>
                    </button>
                </div>
            </form>

            <!-- Limitations Notice -->
            <details class="limitations">
                <summary class="limitations-toggle">æœ¬å°å§èƒ½åšä»€éº¼ï¼ˆé»é–‹çœ‹ï¼‰</summary>
                <div class="limitations-content">
                    <div class="limitations-can">
                        <h4>âœ“ èƒ½åš</h4>
                        <ul>
                            <li>æª¢æŸ¥ HTML è£¡çš„ SEO æ¨™ç±¤ï¼ˆtitleã€metaã€OG ç­‰ï¼‰</li>
                            <li>é©—è­‰çµæ§‹åŒ–è³‡æ–™ï¼ˆJSON-LD Schemaï¼‰</li>
                            <li>åˆ†æç¤¾äº¤åˆ†äº«è¨­å®š</li>
                            <li>ç”¨æ¯’èˆŒçš„æ–¹å¼å‘Šè¨´ä½ å•é¡Œåœ¨å“ª</li>
                        </ul>
                    </div>
                    <div class="limitations-cannot">
                        <h4>âœ— åˆ¥è‚–æƒ³</h4>
                        <ul>
                            <li>æ•´ç«™çˆ¬èŸ²ï¼ˆåªåˆ†æä½ è¼¸å…¥çš„å–®ä¸€é é¢ï¼‰</li>
                            <li>åˆ†æ JavaScript æ¸²æŸ“çš„å…§å®¹ï¼ˆSPA ç¶²ç«™å¯èƒ½ä¸æº–ï¼‰</li>
                            <li>æª¢æ¸¬ç¶²ç«™é€Ÿåº¦ï¼ˆCore Web Vitals éœ€è¦çœŸå¯¦ç€è¦½å™¨ï¼‰</li>
                            <li>åˆ†æåå‘é€£çµã€æ’åã€æµé‡ï¼ˆéœ€è¦ç¬¬ä¸‰æ–¹ APIï¼‰</li>
                        </ul>
                    </div>
                </div>
            </details>
        </section>

        <!-- Result Section -->
        <section id="result-section" class="result-section hidden">
            <!-- Score Card -->
            <div class="score-card">
                <div class="score-circle">
                    <span id="score-value" class="score-value">0</span>
                    <span class="score-label">åˆ†</span>
                </div>
                <div id="grade-badge" class="grade-badge grade-f">F</div>
                <p id="grade-roast" class="grade-roast"></p>
                <p id="analyzed-url" class="analyzed-url"></p>
            </div>

            <!-- Stats -->
            <div class="stats">
                <div class="stat-item stat-passed">
                    <span id="passed-count" class="stat-value">0</span>
                    <span class="stat-label">é€šé</span>
                </div>
                <div class="stat-item stat-failed">
                    <span id="issue-count" class="stat-value">0</span>
                    <span class="stat-label">å•é¡Œ</span>
                </div>
                <div class="stat-item stat-total">
                    <span id="total-count" class="stat-value">0</span>
                    <span class="stat-label">ç¸½é …ç›®</span>
                </div>
            </div>

            <!-- Issues List -->
            <div id="issues-container" class="issues-container">
                <h2 class="section-title">
                    <span class="icon-warning"></span>
                    ä½ çš„å•é¡Œåœ¨é€™
                </h2>
                <div id="issues-list" class="issues-list"></div>
            </div>

            <!-- Passed List -->
            <div id="passed-container" class="passed-container">
                <h2 class="section-title section-title-success">
                    <span class="icon-check"></span>
                    å‹‰å¼·ç®—ä½ éé—œçš„
                </h2>
                <div id="passed-list" class="passed-list"></div>
            </div>
        </section>

        <!-- Error Section -->
        <section id="error-section" class="error-section hidden">
            <div class="error-card">
                <div class="error-icon">!</div>
                <p id="error-message" class="error-message"></p>
                <p id="error-roast" class="error-roast"></p>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p class="disclaimer">
                åæ§½æ­¸åæ§½ï¼ŒSEO é‚„æ˜¯è¦èªçœŸåšå•¦...æ‰ä¸æ˜¯é—œå¿ƒä½ 
            </p>
        </footer>
    </div>

    <script>
        const form = document.getElementById('analyze-form');
        const urlInput = document.getElementById('url-input');
        const submitBtn = document.getElementById('submit-btn');
        const resultSection = document.getElementById('result-section');
        const errorSection = document.getElementById('error-section');
        const loadingText = submitBtn.querySelector('.btn-loading');
        const mascot = document.getElementById('mascot');

        // å‰ç¥¥ç‰©è¡¨æƒ…
        const mascotExpressions = {
            default: "{{ url_for('static', filename='mascot/default.webp') }}",
            loading: "{{ url_for('static', filename='mascot/loading.webp') }}",
            roast: "{{ url_for('static', filename='mascot/roast.webp') }}",
            reluctant: "{{ url_for('static', filename='mascot/reluctant.webp') }}",
            sigh: "{{ url_for('static', filename='mascot/sigh.webp') }}"
        };

        function setMascotExpression(expression) {
            mascot.src = mascotExpressions[expression] || mascotExpressions.default;
        }

        // è¼‰å…¥ä¸­éš¨æ©Ÿå°è©
        const loadingMessages = [
            'æ­£åœ¨æ‰¾ä½ çš„å•é¡Œ...ä¸€å®šå¾ˆå¤š',
            'åœ¨çœ‹äº†åœ¨çœ‹äº†...å‚¬ä»€éº¼',
            'è®“æˆ‘å¥½å¥½æª¢æŸ¥ä¸€ä¸‹',
            'é€™ç¶²ç«™...å—¯...è®“æˆ‘ä»”ç´°çœ‹çœ‹',
            'æ­£åœ¨åˆ†æ...å¸Œæœ›åˆ¥å¤ªæ…˜',
            'æƒæä¸­...åšå¥½å¿ƒç†æº–å‚™',
        ];

        function getRandomLoadingMessage() {
            return loadingMessages[Math.floor(Math.random() * loadingMessages.length)];
        }

        // ç°¡å–®çš„ URL æ ¼å¼é©—è­‰
        function isValidUrl(url) {
            // å…è¨±ä¸å« protocol çš„ç¶²å€ï¼ˆå¾Œç«¯æœƒè‡ªå‹•åŠ ä¸Š https://ï¼‰
            const urlPattern = /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.\-\?\=\&\%\#]*)*\/?$/i;
            return urlPattern.test(url);
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const url = urlInput.value.trim();
            if (!url) {
                showError('è«‹è¼¸å…¥ç¶²å€', 'ç©ºç™½æ˜¯æ€æ¨£ï¼Ÿè¦æˆ‘é€šéˆå—ï¼Ÿ');
                return;
            }

            // å‰ç«¯ URL æ ¼å¼é©—è­‰
            if (!isValidUrl(url)) {
                showError('ç¶²å€æ ¼å¼éŒ¯èª¤', 'é€™ä»€éº¼é¬¼ç¶²å€ï¼Ÿä½ èªçœŸçš„å—ï¼Ÿ');
                return;
            }

            // Show loading state
            loadingText.textContent = getRandomLoadingMessage();
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            resultSection.classList.add('hidden');
            errorSection.classList.add('hidden');
            setMascotExpression('loading');

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url }),
                });

                const data = await response.json();

                if (data.error) {
                    showError(data.message, data.roast);
                } else {
                    showResult(data);
                }
            } catch (err) {
                showError('ç¶²è·¯éŒ¯èª¤', 'é€£ä¸ä¸Š...æ˜¯ä½ çš„ç¶²ç«™æ›äº†é‚„æ˜¯æˆ‘çš„å•é¡Œï¼Ÿç®—äº†è‚¯å®šæ˜¯ä½ çš„å•é¡Œ');
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
            }
        });

        function showError(message, roast) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-roast').textContent = roast || '';
            errorSection.classList.remove('hidden');
            resultSection.classList.add('hidden');
            errorSection.scrollIntoView({ behavior: 'smooth' });
            setMascotExpression('sigh');
        }

        function showResult(data) {
            // Score
            const scoreValue = document.getElementById('score-value');
            animateNumber(scoreValue, 0, data.score, 1000);

            // Grade
            const gradeBadge = document.getElementById('grade-badge');
            gradeBadge.textContent = data.grade;
            gradeBadge.className = `grade-badge grade-${data.grade.toLowerCase()}`;

            // æ ¹æ“šç­‰ç´šåˆ‡æ›è¡¨æƒ…
            const grade = data.grade.toUpperCase();
            if (grade === 'S' || grade === 'A') {
                setMascotExpression('reluctant');  // ä¸æƒ…é¡˜åœ°æ‰¿èªä½ é‚„è¡Œ
            } else {
                setMascotExpression('roast');      // æº–å‚™å¥½åæ§½ä½ äº†
            }

            // Grade roast
            document.getElementById('grade-roast').textContent = data.grade_roast;

            // URL
            document.getElementById('analyzed-url').textContent = data.url;

            // Stats
            document.getElementById('passed-count').textContent = data.passed_count;
            document.getElementById('issue-count').textContent = data.issue_count;
            document.getElementById('total-count').textContent = data.total_checks;

            // Issues
            const issuesList = document.getElementById('issues-list');
            issuesList.innerHTML = '';

            if (data.issues.length === 0) {
                issuesList.innerHTML = '<p class="no-issues">å˜–...å±…ç„¶æ‰¾ä¸åˆ°å•é¡Œã€‚ä½ æ˜¯ä¾†ç‚«è€€çš„å—ï¼Ÿ</p>';
            } else {
                data.issues.forEach((issue, index) => {
                    const issueEl = createIssueElement(issue, index);
                    issuesList.appendChild(issueEl);
                });
            }

            // Passed
            const passedList = document.getElementById('passed-list');
            passedList.innerHTML = '';

            data.passed.forEach(item => {
                const passedEl = createPassedElement(item);
                passedList.appendChild(passedEl);
            });

            // Show result
            errorSection.classList.add('hidden');
            resultSection.classList.remove('hidden');
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function createIssueElement(issue, index) {
            const div = document.createElement('div');
            div.className = 'issue-item';
            // å‹•ç•«å»¶é²æœ€å¤š 1 ç§’ï¼Œé¿å…éé•·ç­‰å¾…
            div.style.animationDelay = `${Math.min(index * 0.1, 1)}s`;

            // XSS é˜²è­·ï¼šæ‰€æœ‰å‹•æ…‹å…§å®¹éƒ½ç¶“éè·³è„«
            div.innerHTML = `
                <div class="issue-header">
                    <span class="issue-name">${escapeHTML(issue.name)}</span>
                    <span class="issue-weight">-${escapeHTML(issue.weight)} åˆ†</span>
                </div>
                <div class="issue-roast">${escapeHTML(issue.roast)}</div>
                ${issue.value ? `<div class="issue-value">ç›®å‰å€¼ï¼š${formatValue(issue.value)}</div>` : ''}
            `;

            return div;
        }

        function createPassedElement(item) {
            const div = document.createElement('div');
            div.className = 'passed-item';

            // XSS é˜²è­·ï¼šæ‰€æœ‰å‹•æ…‹å…§å®¹éƒ½ç¶“éè·³è„«
            div.innerHTML = `
                <span class="passed-icon"></span>
                <span class="passed-name">${escapeHTML(item.name)}</span>
                ${item.value && item.value !== 'no_images' ? `<span class="passed-value">${formatValue(item.value)}</span>` : ''}
            `;

            return div;
        }

        // XSS é˜²è­·ï¼šè·³è„« HTML ç‰¹æ®Šå­—å…ƒ
        function escapeHTML(str) {
            if (str === null || str === undefined) return '';
            const div = document.createElement('div');
            div.textContent = String(str);
            return div.innerHTML;
        }

        function formatValue(value, maxLength = 60) {
            if (Array.isArray(value)) {
                return escapeHTML(value.join(', '));
            }
            if (typeof value === 'string' && value.length > maxLength) {
                return escapeHTML(value.substring(0, maxLength) + '...');
            }
            return escapeHTML(value);
        }

        function animateNumber(element, start, end, duration) {
            const startTime = performance.now();

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // Easing function
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const current = Math.round(start + (end - start) * easeOut);

                element.textContent = current;

                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }

            requestAnimationFrame(update);
        }

    </script>
</body>
</html>
